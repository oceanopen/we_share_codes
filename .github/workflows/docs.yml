# https://docs.github.com/actions
name: Deploy Docs

on:
    # æ”¯æŒæ‰‹åŠ¨è§¦å‘æµæ°´çº¿
    workflow_dispatch:
    push:
        branches:
            - main
        paths:
            - packages/docs/**/**
            - package.json

jobs:
    run:
        name: Docs Build & Deploy
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4 # https://github.com/marketplace/actions/checkout

            - name: Setup Node
              uses: actions/setup-node@v4 # https://github.com/marketplace/actions/setup-node-js-environment
              with:
                  node-version: 20

            # This project is built using npm and outputs the result to the 'build' folder. Replace with the commands required to build your project, or remove this step entirely if your site is pre-built.
            - name: Npm Install and Build ğŸ”§
              run: npm i -g pnpm && pnpm i && pnpm docs:build

            - name: Deploy to Server
              uses: easingthemes/ssh-deploy@main # https://github.com/marketplace/actions/ssh-deploy
              with:
                  # æœ¬åœ° .ssh æ–‡ä»¶ä¸‹çš„ç§é’¥ id_rsaï¼Œå­˜åœ¨ secrets çš„ TOKEN ä¸­
                  SSH_PRIVATE_KEY: ${{ secrets.CVM_PRIVATE_KEY }}
                  # å¤åˆ¶æ“ä½œçš„å‚æ•°ã€‚"-avzr --delete" æ„å‘³éƒ¨ç½²æ—¶æ¸…ç©ºæœåŠ¡å™¨ç›®æ ‡ç›®å½•ä¸‹çš„æ–‡ä»¶
                  # æºç›®å½•ï¼Œç›¸å¯¹äº $GITHUB_WORKSPACE æ ¹ç›®å½•çš„è·¯å¾„
                  SOURCE: packages/docs/dist/
                  # æœåŠ¡å™¨åŸŸå
                  REMOTE_HOST: ${{ secrets.CVM_IP }}
                  # è…¾è®¯äº‘é»˜è®¤ç”¨æˆ·åä¸º root
                  REMOTE_USER: root
                  # ç›®æ ‡ç›®å½•
                  TARGET: /data/web/static/we_share_code/docs
